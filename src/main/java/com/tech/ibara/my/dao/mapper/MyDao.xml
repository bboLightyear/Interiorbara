<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tech.ibara.my.dao.MyDao">
	<sql id="includeWhere">
		<choose>
			<when test="param1==1">
				WHERE MEMNO = #{param2}			
			</when>
			<when test="param1==2">
				WHERE NICKNAME = #{param2}			
			</when>
			<when test="param1==3">
				WHERE EMAIL = #{param2}
			</when>
			<otherwise></otherwise>
		</choose>	
	</sql> 
	<insert id="join">
		INSERT INTO MY_MEMBER_INFO (MEMNO,NICKNAME,SHPWD,BCPWD,EMAIL,
		MAILCHECK,JOINDATE,MEMTYPE) VALUES(MEMNO_SEQ.NEXTVAL,#{param1},
		#{param2},#{param3},#{param4},0,SYSTIMESTAMP,'NOTMAILCHECK')
	</insert>
	<select id="countCheck" resultType="Integer">
		SELECT COUNT(*) FROM MY_MEMBER_INFO <include refid="includeWhere" />
	</select>	
	
	<select id="getMemberEmail" resultType="string">
		SELECT EMAIL FROM MY_MEMBER_INFO WHERE NICKNAME = #{param1}
	</select>
	<select id="getMemberNickname" resultType="string">
		SELECT NICKNAME FROM MY_MEMBER_INFO WHERE EMAIL = #{param1}
	</select>	
	
	<update id="setMemberEmailChecked">
		UPDATE MY_MEMBER_INFO SET MAILCHECK = 1, MEMTYPE='PERSON' WHERE NICKNAME = #{param1}
	</update>	
	
	<select id="getMemberInfo" resultType="com.tech.ibara.my.dto.MyMemberInfoDto">
		SELECT MEMNO,NICKNAME,SHPWD,BCPWD,EMAIL,MAILCHECK,BIRTH,GENDER,
		PHONE,JOINDATE,MEMTYPE,PROFILEIMG FROM MY_MEMBER_INFO <include refid="includeWhere" />
	</select>

	<update id="updateProfileimg">
		UPDATE MY_MEMBER_INFO SET PROFILEIMG = #{param1} WHERE MEMNO = #{param2}
	</update>
	<update id="modifyMyMemberInfo">
		UPDATE MY_MEMBER_INFO SET NICKNAME=#{param1},PHONE=#{param2},
		BIRTH=#{param3},GENDER=#{param4} WHERE EMAIL=#{param5}
	</update>
	<insert id="insertMyWithdrawal">
		INSERT INTO MY_WITHDRAWAL VALUES(WDNO_SEQ.NEXTVAL,#{param1},SYSTIMESTAMP,#{param2},'N')
	</insert>
	
	<update id="updatePassword">
		UPDATE MY_MEMBER_INFO SET SHPWD=#{param1}, BCPWD=#{param2}  WHERE NICKNAME = #{param3}
	</update>
	<select id="getmailcheckNum" resultType="Integer">
		SELECT MAILCHECK FROM MY_MEMBER_INFO WHERE NICKNAME = #{param1}
	</select>
	<select id="getDemandWithdrawalMember" resultType="com.tech.ibara.my.dto.MyWithdrawalDto">
		SELECT WDNO,MEMNO,WDDATE,REASON,YESNO FROM MY_WITHDRAWAL ORDER BY WDNO DESC
	</select>
	<select id="memnoDuplCheck" resultType="Integer">
		SELECT COUNT(*) FROM MY_WITHDRAWAL WHERE MEMNO=#{param1}
	</select>
	<select id="yesnoCheck_Withdrawal" resultType="string">
		SELECT YESNO FROM MY_WITHDRAWAL WHERE MEMNO=#{param1}
	</select>
	<update id="allowWithdrawal">
		UPDATE MY_WITHDRAWAL SET YESNO=#{param1} WHERE MEMNO=#{param2}	
	</update>
	<select id="getMemtype" resultType="string">
		SELECT MEMTYPE FROM MY_MEMBER_INFO WHERE MEMNO=#{param1}
	</select>
	<update id="completedWithdrawal">
		UPDATE MY_MEMBER_INFO SET MEMTYPE='WITHDRAWAL' WHERE MEMNO = #{param1}
	</update>
	<update id="cancelWithdrawal">
		UPDATE MY_MEMBER_INFO SET MEMTYPE='PERSON' WHERE MEMNO = #{param1}
	</update>
	
	<select id="getMemberInfoList" resultType="com.tech.ibara.my.dto.MyMemberInfoDto">
		SELECT MEMNO,NICKNAME,SHPWD,BCPWD,EMAIL,MAILCHECK,BIRTH,GENDER,
		PHONE,JOINDATE,MEMTYPE,PROFILEIMG FROM MY_MEMBER_INFO ORDER BY MEMNO
	</select>
	<insert id="insertInterior">
		INSERT INTO MY_INTERIOR VALUES(INTENO_SEQ.NEXTVAL,#{param1},#{param2})
	</insert>
	<insert id="insertSeller">
		INSERT INTO MY_SELLER VALUES(SELLERNO_SEQ.NEXTVAL,#{param1},#{param2})
	</insert>
	<select id="countCheckInterior" resultType="Integer">
		SELECT COUNT(*) FROM MY_INTERIOR WHERE INTERIORNUM=#{param1}
	</select>
		
	<select id="countCheckSeller" resultType="Integer">
		SELECT COUNT(*) FROM MY_SELLER WHERE SELLERNUM=#{param1}
	</select>
	<update id="completedInterior">
		UPDATE MY_MEMBER_INFO SET MEMTYPE='INTERIOR' WHERE MEMNO = #{param1}
	</update>
	<update id="completedSeller">
		UPDATE MY_MEMBER_INFO SET MEMTYPE='SELLER' WHERE MEMNO = #{param1}
	</update>
	<!-- <delete id="deleteInterior">
		DELETE FROM MY_INTERIOR WHERE MEMNO=#{param1}
	</delete>
	<delete id="deleteSeller">
		DELETE FROM MY_SELLER WHERE MEMNO=#{param1}
	</delete> -->
	<delete id="deleteDemandWithdrawal">
		DELETE FROM MY_WITHDRAWAL WHERE MEMNO=#{param1}
	</delete>
	<select id="countCheckNonmember" resultType="Integer">
		SELECT COUNT(*) FROM MY_NONMEMBER WHERE EMAIL=#{param1}
	</select>	
	<select id="getNonmember" resultType="com.tech.ibara.my.dto.MyNonMemberDto">
		SELECT ESTINO,NAME,PHONE,EMAIL,PW FROM MY_NONMEMBER WHERE EMAIL=#{param1} 
	</select>
	<!-- <select id="getInterior" resultType="com.tech.ibara.my.dto.MyInteriorDto">
		SELECT INTENO,MEMNO,INTERIORNUM FROM MY_INTERIOR WHERE MEMNO=#{param1}
	</select>
	<select id="getSeller" resultType="com.tech.ibara.my.dto.MySellerDto">
		SELECT SELLERNO,MEMNO,SELLERNUM FROM MY_SELLER WHERE MEMNO=#{param1}
	</select> -->
	<resultMap type="com.tech.ibara.my.dto.MyInteriorDto" id="MyInteriorDto">
		<result column="INTENO" property="inteno"/>
		<result column="MEMNO" property="memno"/>
		<result column="INTERIORNUM" property="interiornum"/>
	</resultMap>
	<resultMap type="com.tech.ibara.my.dto.MySellerDto" id="MySellerDto">
		<result column="SELLERNO" property="sellerno"/>
		<result column="MEMNO" property="memno"/>
		<result column="SELLERNUM" property="sellernum"/>
	</resultMap>
	<resultMap type="com.tech.ibara.my.dto.MyMemberInfoDto" id="MyMemberInfoDtoI">
		<result column="MEMNO" property="memno"/>
		<result column="NICKNAME" property="nickname"/>
		<result column="SHPWD" property="shpwd"/>
		<result column="BCPWD" property="bcpwd"/>
		<result column="EMAIL" property="email"/>
		<result column="MAILCHECK" property="mailcheck"/>
		<result column="BIRTH" property="birth"/>
		<result column="GENDER" property="gender"/>
		<result column="PHONE" property="phone"/>
		<result column="JOINDATE" property="joindate"/>
		<result column="MEMTYPE" property="memtype"/>
		<result column="PROFILEIMG" property="profileimg"/>
		<collection property="myinteriordto" resultMap="MyInteriorDto"></collection>
	</resultMap>
	<resultMap type="com.tech.ibara.my.dto.MyMemberInfoDto" id="MyMemberInfoDtoS">
		<result column="MEMNO" property="memno"/>
		<result column="NICKNAME" property="nickname"/>
		<result column="SHPWD" property="shpwd"/>
		<result column="BCPWD" property="bcpwd"/>
		<result column="EMAIL" property="email"/>
		<result column="MAILCHECK" property="mailcheck"/>
		<result column="BIRTH" property="birth"/>
		<result column="GENDER" property="gender"/>
		<result column="PHONE" property="phone"/>
		<result column="JOINDATE" property="joindate"/>
		<result column="MEMTYPE" property="memtype"/>
		<result column="PROFILEIMG" property="profileimg"/>
		<collection property="mysellerdto" resultMap="MySellerDto"></collection>
	</resultMap>
	<select id="getInteriorMember" resultType="com.tech.ibara.my.dto.MyMemberInfoDto" resultMap="MyMemberInfoDtoI">
		SELECT M.MEMNO,NICKNAME,SHPWD,BCPWD,EMAIL,MAILCHECK,BIRTH,GENDER,PHONE,
		JOINDATE,MEMTYPE,PROFILEIMG,INTENO,INTERIORNUM FROM MY_MEMBER_INFO M JOIN
		MY_INTERIOR I ON M.MEMNO=I.MEMNO WHERE M.MEMNO=#{param1}
	</select>
	<select id="getSellerMember" resultType="com.tech.ibara.my.dto.MyMemberInfoDto" resultMap="MyMemberInfoDtoS">
		SELECT M.MEMNO,NICKNAME,SHPWD,BCPWD,EMAIL,MAILCHECK,BIRTH,GENDER,PHONE,
		JOINDATE,MEMTYPE,PROFILEIMG,SELLERNO,SELLERNUM FROM MY_MEMBER_INFO M JOIN 
		MY_SELLER S ON M.MEMNO=S.MEMNO WHERE S.MEMNO=#{param1}
	</select>
	<resultMap type="com.tech.ibara.my.dto.BizRvReportedDto" id="BizRvReportedDto">
		<result column="BRR_NO" property="brr_no"/>
		<result column="BRR_CONTENT" property="brr_content"/>
		<result column="BRR_WRITER" property="brr_writer"/>
		<result column="BR_NO" property="br_no"/>
	</resultMap>
	<resultMap type="com.tech.ibara.my.dto.MyReportDto" id="MyReportDto">
		<result column="RENO" property="reno"/>
		<result column="TARGETNO" property="targetno"/>
		<result column="TARGETTYPE" property="targettype"/>
		<result column="MEMNO" property="memno"/>
		<result column="TARGETMEMNO" property="targetmemno"/>
		<result column="CAUSE" property="cause"/>
		<result column="REDATE" property="redate"/>
		<result column="YESNO" property="yesno"/>
		<collection property="bizRvReportedDto" resultMap="BizRvReportedDto"></collection>
	</resultMap>
	<select id="getReportList" resultType="com.tech.ibara.my.dto.MyReportDto" resultMap="MyReportDto">
		SELECT MY.RENO,MY.TARGETNO,MY.TARGETTYPE,MY.MEMNO,MY.TARGETMEMNO,MY.CAUSE,MY.REDATE,
		MY.YESNO,BIZ.BRR_CONTENT,BIZ.BRR_WRITER FROM MY_REPORT MY 
		JOIN BIZ_RV_REPORTED BIZ ON MY.TARGETNO=BIZ.BR_NO
	</select>
	<!-- <select id="yesnoCheck_Report" resultType="string">
		SELECT YESNO FROM MY_REPORT WHERE RENO=#{param1}
	</select> -->
	<update id="allowBlind">
		UPDATE MY_REPORT SET YESNO=#{param1} WHERE RENO=#{param2}	
	</update>
	<select id="getReportRv" resultType="com.tech.ibara.my.dto.MyReportDto" resultMap="MyReportDto">
		SELECT MY.RENO,MY.TARGETNO,MY.TARGETTYPE,MY.MEMNO,MY.TARGETMEMNO,MY.CAUSE,MY.REDATE,
		MY.YESNO,BIZ.BRR_CONTENT,BIZ.BRR_WRITER,BIZ.BR_NO FROM MY_REPORT MY 
		JOIN BIZ_RV_REPORTED BIZ ON MY.TARGETNO=BIZ.BR_NO WHERE RENO=#{param1}
	</select>
	<update id="blindReview">
		UPDATE BIZ_RV SET BR_CONTENT='신고로인해 블라인드처리된 글입니다',BR_WRITER='비공개' WHERE BR_NO=#{param1}
	</update>
	<update id="saveReview">
		UPDATE BIZ_RV SET BR_CONTENT=#{param1},BR_WRITER=#{param2} WHERE BR_NO=#{param3}
	</update>
	<select id="countLikePhotoBoard" resultType="Integer">
		SELECT COUNT(*) FROM OH_PHOTO_LIKE WHERE MEMNO=#{param1}
	</select>
	<!-- <select id="countLikePhotoReply" resultType="Integer">
		SELECT COUNT(*) FROM OH_PHOTO_REPLY_LIKE WHERE MEMNO=#{param1}
	</select> -->
	<select id="countScrapPhotoBoard" resultType="Integer">
		SELECT COUNT(*) FROM OH_PHOTO_SCRAP WHERE MEMNO=#{param1}
	</select>
	<select id="countBizBmark" resultType="Integer">
		SELECT COUNT(*) FROM BIZ_HOME_BMARK WHERE MEMNO=#{param1}
	</select>
	<!-- <select id="getBizHomeBmark" resultType="">
		SELECT BHB_NO,INTENO FROM BIZ_HOME_BMARK WHERE MEMNO=#{param1}
	</select> -->
	<resultMap type="com.tech.ibara.my.dto.PhotoBoardDto" id="PhotoBoardDto">
		<result column="NO" property="no" />
		<result column="PB_NO" property="pb_no" />
		<result column="PB_USER" property="pb_user" />
		<result column="PB_TITLE" property="pb_title" />
		<result column="PB_CONTENT" property="pb_content" />
		<result column="PB_DATE" property="pb_date" />
		<result column="PB_LIKE" property="pb_like" />
		<result column="PB_SCRAP" property="pb_scrap" />
		<result column="PB_REPLY" property="pb_reply" />
		<result column="PB_LINK" property="pb_link" />
		<result column="PB_HIT" property="pb_hit" />
		<result column="PB_CATEGORY" property="pb_category" />
		<result column="PB_RESIDENCE" property="pb_residence" />
		<result column="PB_ROOM" property="pb_room" />
		<result column="PB_STYLE" property="pb_style" />
		<result column="PB_SKILL" property="pb_skill" />
		<!-- collection -->
	</resultMap>
	
	<!-- resultMap OHPhotoAttach -->
	
	<resultMap type="com.tech.ibara.my.dto.PhotoAttachDto" id="PhotoAttachDto">
		<result column="PA_NO" property="pa_no" />
		<result column="PA_ATTACH" property="pa_attach" />
		<result column="PB_NO" property="pb_no" />
		<collection property="photoBoardDto" resultMap="PhotoBoardDto"/>
	</resultMap>	
	<resultMap type="com.tech.ibara.my.dto.PhotoAttachDto" id="PhotoAttachDtoAtt">
		<result column="PA_NO" property="pa_no" />
		<result column="PA_ATTACH" property="pa_attach" />
		<result column="PB_NO" property="pb_no" />
		<result column="ATTACHS" property="attachs" />
		<collection property="photoBoardDto" resultMap="PhotoBoardDto"/>
	</resultMap>
	
	<select id="getMyPhoto" resultType="com.tech.ibara.my.dto.PhotoAttachDto" resultMap="PhotoAttachDto">
		SELECT PB.PB_NO,PB.PB_TITLE,PA.PA_ATTACH FROM OH_PHOTO_BOARD PB JOIN OH_PHOTO_ATTACH PA 
		ON PB.PB_NO=PA.PB_NO WHERE PB.MEMNO=#{param1} ORDER BY PB_NO DESC
	</select>
	<select id="getMyPhotoBoardList" resultType="com.tech.ibara.my.dto.PhotoAttachDto" resultMap="PhotoAttachDtoAtt">
		SELECT PB.PB_NO,PB.PB_TITLE,LISTAGG(PA.PA_ATTACH,',') WITHIN GROUP(ORDER BY PA.PA_ATTACH DESC) ATTACHs
		FROM OH_PHOTO_BOARD PB JOIN OH_PHOTO_ATTACH PA ON PB.PB_NO=PA.PB_NO WHERE PB.MEMNO=#{param1}
		GROUP BY PB.PB_NO,PB.PB_TITLE
	</select>
	<resultMap type="com.tech.ibara.my.dto.InteriorCasesDto" id="InteriorCasesDto">
		<result column="BC_NO" property="bc_no" />
		<result column="BC_TITLE" property="bc_title" />
		<result column="BC_CONTENT" property="bc_content" />
		<result column="BC_DATE" property="bc_date" />
		<result column="BC_HIT" property="bc_hit" />
		<result column="INTENO" property="inteno" />	
	</resultMap>
	<resultMap type="com.tech.ibara.my.dto.InteriorCasesImgDto" id="InteriorCasesImgDto">
		<result column="BCIMG_NO" property="bcimg_no" />	
		<result column="BCIMG_OGN" property="bcimg_ogn" />	
		<result column="BCIMG_CGN" property="bcimg_cgn" />	
		<result column="BC_NO" property="bc_no" />	
		<result column="INTENO" property="inteno" />
		<result column="IMGS" property="imgs" />
		<collection property="inteCasesDto" resultMap="InteriorCasesDto" />
	</resultMap>
	<select id="getMyCasesList" resultType="com.tech.ibara.my.dto.InteriorCasesImgDto" resultMap="InteriorCasesImgDto">
		SELECT BC.BC_NO,BC.BC_TITLE,BC.BC_CONTENT,LISTAGG(BCI.BCIMG_CGN,',') WITHIN GROUP(ORDER BY BCI.BCIMG_CGN) IMGS
		FROM BIZ_CASES BC JOIN BIZ_CASES_IMG BCI ON BC.BC_NO=BCI.BC_NO WHERE BC.INTENO=#{param1}
		GROUP BY BC.BC_NO,BC.BC_TITLE,BC.BC_CONTENT	
	</select>
	
	
	
</mapper>
